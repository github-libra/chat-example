<!DOCTYPE html>
<html>

<head>
    <title>Socket</title>
</head>

<body>
    <button id="btn1">env101</button>
    <button id="btn2">env102</button>
    <button id="put">put</button>
    <button id="delete">socket</button>
    <pre id="info"></pre>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.js"></script>
    <script>
    $env101 = $('#btn1');
    $env102 = $('#btn2');
    $info = $('#info');
    $put = $('#put')
    $delete = $('#delete')

    var client = io.connect('/ilab'),
        currentRoom = '';

    client.on('connect', function() {
        client.emit('subscribe', {
            toRoom: 'env101'
        });
        currentRoom = 'env101';
        $info.append('<p> in room env101</p>')
        console.log( client );
        $info.append('<p> socketid: '+ client.io.engine.id+'</p>')
    });

    client.on('update', function(data) {
        $info.append('<p>socket:' + JSON.stringify(data) + '</p>')
    })

    $put.on('click', function() {
        $.ajax({
            method: 'PUT', 
            url: '/env',
            data: {id: "env101"},
            success: function(res) {
                $info.append('<p>'+JSON.stringify(res)+'</p>');
            },
            error: function(err) {
                $info.append('<p>'+JSON.stringify(err)+'</p>');
            }
        })
    })
    $delete.on('click', function() {
        client.emit('delete', 'delete socket');
    })

    $env101.on('click', function(e) {
        if(currentRoom === 'env101') return;
        client.emit('unsubscribe', {fromRoom: 'env102'});
        client.emit('subscribe', {toRoom: 'env101'});
        currentRoom = 'env101'
        $info.append('<p> in room env101</p>')

    })

    $env102.on('click', function(e) {
        if(currentRoom === 'env102') return;
        client.emit('unsubscribe', {fromRoom: 'env101'});
        client.emit('subscribe', {toRoom: 'env102'});
        currentRoom = 'env102'
        $info.append('<p> in room env102</p>')

    })    
    </script>
</body>

</html>
