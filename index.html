
<!DOCTYPE html>
<html>
<head>
    <title>Socket</title>
    <style>
    #dialog {
        width: 500px;
        height: 400px;
        border: 1px solid;
        overflow: auto;
        margin-top: 50px;
    }
    </style>
</head>
<body>

    <h1>Chat</h1>
    <div id="btngroup">
        <button id="chatroom1">chatroom 1</button>
        <button id="chatroom2">chatroom 2</button> 
    </div>
    <div id="dialog"></div>

    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.js"></script>
    <script>

    $(function() {

        $chatroom1 = $("#chatroom1");
        $chatroom2 = $("#chatroom2");
        $dialog = $("#dialog");
        $btngroup = $("#btngroup");

        var client = io.connect('/chat');
        client.on('connect', function(data) {
            $dialog.append('<p>connected to server</p>');
            $chatroom1.prop('disabled', true);
            client.room = 'chatroom1';
            client.emit('subscribe', {room: 'chatroom1'});
        })
        client.on('update-room', function(data) {
            $dialog.append('<p>in '+ data +'</p>')
        })

        client.on('msg', function(msg) {
            $dialog.append('<p>' + msg + '</p>');
            $dialog.scrollTop($dialog[0].scrollHeight);
        })

        //event
        $btngroup.delegate('button', 'click', function() {
            $dialog.text("");

            if(this.id === client.room) {
                return false;
            }
            $(this).prop('disabled', true);
            $('#'+client.room).prop('disabled', false);
            console.log( client.room );
            client.emit('subscribe', {room: this.id, old: client.room})
            client.room = this.id;
            console.log( client.room );
            
        })

    })
        
    </script>
</body>
</html>